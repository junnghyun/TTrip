<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="mapper.dashboardMapper">
    <select id="getTopRecommendedRegions" resultType="com.ttrip.admin.dashboard.DashboardDomain">
        SELECT 
            r.regionID as regionId,
            r.region as region,
            COUNT(DISTINCT tbr.nick) as recomCount,
            COUNT(DISTINCT tb.trip_boardID) as postCount
        FROM region r
        LEFT JOIN trip_board tb ON r.regionID = tb.regionID AND tb.status = 'Y'
        LEFT JOIN trip_board_recom tbr ON tb.trip_boardID = tbr.trip_boardID
        GROUP BY r.regionID, r.region
        ORDER BY recomCount DESC, postCount DESC
    </select>
</mapper>
